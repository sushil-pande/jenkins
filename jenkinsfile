pipeline
{
    agent any
    options 
    {
        disableConcurrentBuilds()
    }
    stages
    {
        stage("BuildOnSlaves")
        {
            parallel
            {   
                stage("FrontEnd")
                {
                    agent {label "aws"}
                    steps
                    {
                        echo "====++++executing FrontEnd ++++===="
                        echo "====++++Loading Environment++++===="
                        script 
                        {
                            if (env.BRANCH_NAME == 'development') 
                            {
						        load '/home/ubuntu/env/qa.groovy'
                                echo "====++++QA environmnet loaded++++===="
                                echo "====++++BuildingApp++++===="
                                sh '''cd basixsWebApp && npm run fast:build:qa:main'''
					        } else if(env.BRANCH_NAME == 'master')
                            {
						        load '/home/ubuntu/env/prod.groovy'
                                echo "====++++Prod environmnet loaded++++===="
                                echo "====++++BuildingApp++++===="
                                sh '''cd basixsWebApp && npm run fast:build:prod:main'''
					        }
                        }
                    }
                }
                stage("FrontEnd-Server")
                {
                    agent {label "aws"}
                    steps
                    {
                        echo "====++++FrontEnd-Server++++===="
                        echo "====++++Loading Environment++++===="
                        script
                        {
                            if (env.BRANCH_NAME == 'development') 
                            {
						        load '/home/ubuntu/env/qa.groovy'
                                echo "====++++QA environmnet loaded++++===="
                                sh '''cd basixsWebApp && npm run fast:build:qa:agent'''
					        } else if(env.BRANCH_NAME == 'master')
                            {
						        load '/home/ubuntu/env/prod.groovy'
                                echo "====++++Prod environmnet loaded++++===="
                                sh '''cd basixsWebApp && npm run fast:build:prod:agent'''
					        }
                        }
                    }
                }
                stage("Backend")
                {
                    agent {label "aws"}
                    steps
                    {
                        echo "====++++Backend++++===="
                        echo "====++++Loading Environment++++===="
                        script
                        {
                            if (env.BRANCH_NAME == 'development') 
                            {
						        load '/home/ubuntu/env/qa.groovy'
                                echo "====++++QA environmnet loaded++++===="
                                sh '''cd basixsWebApp && npm run fast:build:qa:manager'''
					        } else if(env.BRANCH_NAME == 'master')
                            {
						        load '/home/ubuntu/env/prod.groovy'
                                echo "====++++Prod environmnet loaded++++===="
                                sh '''cd basixsWebApp && npm run fast:build:prod:manager'''
					        }
                        }
                    }
                }
                stage("ImapListener")
                {
                    agent {label "aws"}
                    steps
                    {
                        echo "====++++ImapLister++++===="
                        echo "====++++Loading Environment++++===="
                        script
                        {
                            if (env.BRANCH_NAME == 'development') 
                            {
						        load '/home/ubuntu/env/qa.groovy'
                                sh '''cd basixsWebApp && npm run fast:build:qa:admin'''
                                echo "====++++QA environmnet loaded++++===="
					        } else if(env.BRANCH_NAME == 'master')
                            {
						        load '/home/ubuntu/env/prod.groovy'
                                echo "====++++Prod environmnet loaded++++===="
                                sh '''cd basixsWebApp && npm run fast:build:prod:admin'''
					        }
                        }
                    }
                }
            }
        }
    }
}